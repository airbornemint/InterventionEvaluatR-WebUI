<%
  `%|%` = function(a, b) b(a)

  formatMonth = function(date) {
    strftime(date, "%B %Y")
  }
  
  latex = function(str) {
    kableExtra:::escape_latex(str)
  }
%>
\documentclass[11pt,svgnames]{scrreprt}
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}

\usepackage{tikz}
\usepackage{fontspec}
\usepackage[explicit]{titlesec}

\newfontface\robotobold{Roboto-Medium}
\newfontface\robotolight{Roboto-Light}

\definecolor{ChapterColor}{RGB}{66,133,244}
\definecolor{SectionColor}{RGB}{248,248,248}
\definecolor{SectionTextColor}{RGB}{0,123,255}

\titleformat{\chapter}
  {\normalfont\huge\bfseries}{}{0em}
  {%
  \begin{tikzpicture}
  \node[inner xsep=0pt,text width=\textwidth,
    align=left,left color=ChapterColor,right color=ChapterColor] 
    {\parbox[t][2em]{\linewidth}{\robotobold\center\textcolor{White}{#1}}};
  \end{tikzpicture}%
  }

\titleformat{\section}
  {\normalfont\LARGE\bfseries}{}{0em}
  {%
  \begin{tikzpicture}
  \node[inner xsep=0pt,text width=\textwidth,
    align=left,left color=SectionColor,right color=SectionColor] 
    {\parbox[c][2em]{\linewidth}{\qquad\robotolight\raggedright\textcolor{SectionTextColor}{#1}}};
  \end{tikzpicture}%
  }

\titlespacing\chapter{0em}{0em}{0em}
%\titlespacing\section{0em}{0em}{0em}

\title{InterventionEvaluatR Report}

\begin{document}

\maketitle

<%
for(idx in seq_along(results$plots)) { 
  groupName = names(results$plots)[idx]
  groupFileName = gsub("[^a-zA-Z0-9_.-]", "-", groupName)
  prevented = "XXX"
  preventedLCL = "YYY"
  preventedUCL = "ZZZ"
%>

\section*{<%= groupName %|% latex %>}

\subsection*{Summary}

The analysis of \texttt{<%= outcomeCol %|% latex %> / <%= denomCol %|% latex %>} in \texttt{<%= groupName %|% latex %>} found that vaccine introduced in <%= postStart %|% formatMonth %|% latex %> prevented <%= prevented %|% latex %> (95\% CI: <%= preventedLCL %|% latex %>–<%= preventedUCL %|% latex %>) cases between <%= postStart %|% formatMonth %|% latex %> and <%= postEnd %|% formatMonth %|% latex %>.

\section*{Prevented Cases}

\begin{center}
\includegraphics{Plots/<%= groupFileName %>/prevented-cases}
\end{center}

\section*{Total cases (yearly)}

\begin{center}
\includegraphics{Plots/<%= groupFileName %>/cases-yearly}
\end{center}

\section*{Total cases (monthly)}

\begin{center}
\includegraphics{Plots/<%= groupFileName %>/cases-monthly}
\end{center}

\section*{Covariate Comparison}

\begin{center}
\includegraphics{Plots/<%= groupFileName %>/covariate-comparison}
\end{center}

<%
}
%>

\end{document}
